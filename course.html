<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Course Content</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        /* Add smooth scrolling */
        html {
            scroll-behavior: smooth;
        }
        
        /* Fade-in animation */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.6s ease-out forwards;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-gray-100 font-sans">

    <!-- Navigation Bar -->
    <nav class="bg-gradient-to-r from-blue-600 to-blue-800 shadow-lg sticky top-0 z-50 transition-all duration-300">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <a href="/" class="text-white text-2xl font-bold hover:text-gray-300 transition-colors duration-300 transform hover:scale-105">EduVance</a>
                </div>
                <div class="flex space-x-4">
                    <a href="dashboard.html" class="text-white hover:bg-blue-700 px-4 py-2 rounded-md text-lg transition-all duration-300 hover:scale-105 hover:shadow-md">Dashboard</a>
                    <a href="assignments.html" class="text-white hover:bg-blue-700 px-4 py-2 rounded-md text-lg transition-all duration-300 hover:scale-105 hover:shadow-md">Assignment</a>
                    <a href="profile.html" class="text-white hover:bg-blue-700 px-4 py-2 rounded-md text-lg transition-all duration-300 hover:scale-105 hover:shadow-md">Profile</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container mx-auto p-6 space-y-8">
        <h1 class="text-4xl font-extrabold text-center bg-gradient-to-r from-blue-600 to-blue-800 bg-clip-text text-transparent pb-2 mb-8 transform hover:scale-105 transition-transform duration-300">Course Content</h1>

        <!-- Course Content Sections -->
        <div class="bg-white p-8 rounded-2xl shadow-xl hover:shadow-2xl transition-shadow duration-300">
            <!-- Subject Section Template -->
            <div class="space-y-8">
                <!-- Maths Section -->
                <section class="fade-in" style="animation-delay: 0.2s">
                    <h2 class="text-2xl font-bold bg-gradient-to-r from-blue-600 to-blue-800 text-white p-4 rounded-lg shadow-md mb-6 transform hover:scale-102 transition-transform duration-300">Mathematics</h2>
                    <div id="videos-container-maths" class="flex space-x-6 overflow-x-auto pb-4 scrollbar-hide">
                        <!-- Video containers with enhanced styling -->
                        <div class="min-w-[300px] rounded-xl overflow-hidden shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105">
                            <iframe id="video1" width="300" height="169" src="https://www.youtube.com/embed/6AImCqiv7UY?enablejsapi=1" title="YouTube video player" class="rounded-t-xl" frameborder="0" allowfullscreen></iframe>
                            <div class="p-4 bg-gray-50">
                                <h3 class="text-lg font-semibold text-blue-700">Mathematics Fundamentals</h3>
                                <p class="text-sm text-gray-600">Basic Concepts and Applications</p>
                            </div>
                        </div>
                        <!-- Repeat similar structure for other videos -->
                        <div class="min-w-[300px] rounded-xl overflow-hidden shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105">
                            <iframe id="video2" width="300" height="169" src="https://www.youtube.com/embed/videoseries?si=X3sYzfMma5iCQ2S6&amp;list=PLcJiYBaxEj81YRp00ZkyO7fb4CYLEZKhw" title="YouTube video player" class="rounded-t-xl" frameborder="0" allowfullscreen></iframe>
                        </div>
                        <div class="min-w-[300px] rounded-xl overflow-hidden shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105">
                            <iframe id="video3" width="300" height="169" src="https://www.youtube.com/embed/videoseries?si=hONO8fvDoRLpiSvj&amp;list=PLVLoWQFkZbhW1YSpUGOUrqAu7SvJCaZNQ" title="YouTube video player" class="rounded-t-xl" frameborder="0" allowfullscreen></iframe>
                        </div>
                        <div class="min-w-[300px] rounded-xl overflow-hidden shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105">
                            <iframe id="video4" width="300" height="169" src="https://www.youtube.com/embed/videoseries?si=hYeEW6ecumSB1Mbg&amp;list=PLAODbdRxgpSN7zZdJObTH9NK4yRxs5fhA" title="YouTube video player" class="rounded-t-xl" frameborder="0" allowfullscreen></iframe>
                        </div>
                    </div>
                </section>

                <!-- Physics Section -->
                <section class="fade-in" style="animation-delay: 0.4s">
                    <h2 class="text-2xl font-bold bg-gradient-to-r from-blue-600 to-blue-800 text-white p-4 rounded-lg shadow-md mb-6 transform hover:scale-102 transition-transform duration-300">Physics</h2>
                    <div id="videos-container-physics" class="flex space-x-6 overflow-x-auto pb-4 scrollbar-hide">
                        <div class="min-w-[300px] rounded-xl overflow-hidden shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105">
                            <iframe id="video5" width="300" height="169" src="https://www.youtube.com/embed/eCTnAyc9m3k?enablejsapi=1" title="YouTube video player" class="rounded-t-xl" frameborder="0" allowfullscreen></iframe>
                        </div>
                        <div class="min-w-[300px] rounded-xl overflow-hidden shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105">
                            <iframe id="video6" width="300" height="169" src="https://www.youtube.com/embed/videoseries?si=_rFSqySnMbuaoHzL&amp;list=PLVLoWQFkZbhXAipqg8dmzLQOED1uxgUTx" title="YouTube video player" class="rounded-t-xl" frameborder="0" allowfullscreen></iframe>
                        </div>
                        <div class="min-w-[300px] rounded-xl overflow-hidden shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105">
                            <iframe id="video7" width="300" height="169" src="https://www.youtube.com/embed/videoseries?si=9ag6TXa6Nbycv41Y&amp;list=PLVLoWQFkZbhXPtVijvwSni52nnKIh7p2k" title="YouTube video player" class="rounded-t-xl" frameborder="0" allowfullscreen></iframe>
                        </div>
                    </div>
                </section>

                <!-- Chemistry Section -->
                <section class="fade-in" style="animation-delay: 0.6s">
                    <h2 class="text-2xl font-bold bg-gradient-to-r from-blue-600 to-blue-800 text-white p-4 rounded-lg shadow-md mb-6 transform hover:scale-102 transition-transform duration-300">Chemistry</h2>
                    <div id="videos-container-chemistry" class="flex space-x-6 overflow-x-auto pb-4 scrollbar-hide">
                        <div class="min-w-[300px] rounded-xl overflow-hidden shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105">
                            <iframe id="video8" width="300" height="169" src="https://www.youtube.com/embed/videoseries?si=iIXqvNF2KMgTiTBZ&amp;list=PLVLoWQFkZbhVbIi9ux7sKREnFo3jrrKzQ" title="YouTube video player" class="rounded-t-xl" frameborder="0" allowfullscreen></iframe>
                        </div>
                        <div class="min-w-[300px] rounded-xl overflow-hidden shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105">
                            <iframe id="video9" width="300" height="169" src="https://www.youtube.com/embed/videoseries?si=empUa5uLsV6dG7y8&amp;list=PLVLoWQFkZbhW-jg1uCwnBXFE4dI9O87ni" title="YouTube video player" class="rounded-t-xl" frameborder="0" allowfullscreen></iframe>
                        </div>
                    </div>
                </section>

                <!-- Biology Section -->
                <section class="fade-in" style="animation-delay: 0.8s">
                    <h2 class="text-2xl font-bold bg-gradient-to-r from-blue-600 to-blue-800 text-white p-4 rounded-lg shadow-md mb-6 transform hover:scale-102 transition-transform duration-300">Biology</h2>
                    <div id="videos-container-biology" class="flex space-x-6 overflow-x-auto pb-4 scrollbar-hide">
                        <div class="min-w-[300px] rounded-xl overflow-hidden shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105">
                            <iframe id="video10" width="300" height="169" src="https://www.youtube.com/embed/videoseries?si=9tdu79xrWGNB-nPs&amp;list=PLVLoWQFkZbhU9Q_nMpMMB9HHyy4_AUXID" title="YouTube video player" class="rounded-t-xl" frameborder="0" allowfullscreen></iframe>
                        </div>
                        <div class="min-w-[300px] rounded-xl overflow-hidden shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105">
                            <iframe id="video11" width="300" height="169" src="https://www.youtube.com/embed/videoseries?si=aoRoq_JOXxLSsc4H&amp;list=PLVLoWQFkZbhXuBRmnH3CwHsk3ZzNHbXmG" title="YouTube video player" class="rounded-t-xl" frameborder="0" allowfullscreen></iframe>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gradient-to-r from-gray-800 to-gray-900 text-white text-center py-6 mt-8">
        <p class="text-sm font-medium">© 2024 EduVance. All rights reserved.</p>
    </footer>

    <!-- YouTube API and Progress Tracking -->
    <script>
        const BASE_URL = 'http://localhost:5000'; // Add this line

        let players = {};
        let progressIntervals = {};

        function onYouTubeIframeAPIReady() {
            const videoIds = ['video1', 'video2', 'video3', 'video4', 'video5', 'video6', 'video7', 'video8'];
            videoIds.forEach(id => {
                players[id] = new YT.Player(id, {
                    events: {
                        'onStateChange': onPlayerStateChange,
                        'onReady': onPlayerReady
                    }
                });
            });
        }

        function onPlayerReady(event) {
            const videoId = event.target.getIframe().id;
            players[videoId].duration = event.target.getDuration();
        }

        function onPlayerStateChange(event) {
            const videoId = event.target.getIframe().id;
            
            if (event.data === YT.PlayerState.PLAYING) {
                // Clear any existing interval
                if (progressIntervals[videoId]) {
                    clearInterval(progressIntervals[videoId]);
                }

            } else if (event.data === YT.PlayerState.ENDED) {
                // Video completed
                updateProgress(videoId, 100);
                clearInterval(progressIntervals[videoId]);

            } else if (event.data === YT.PlayerState.PAUSED) {
                // Video paused - update progress
                clearInterval(progressIntervals[videoId]);
                const currentTime = event.target.getCurrentTime();
                const duration = players[videoId].duration;
                const progress = Math.floor((currentTime / duration) * 100);
                updateProgress(videoId, progress);
            }
        }

        function updateProgress(videoId, progressPercentage) {
            console.log(`Updating progress for ${videoId}: ${progressPercentage}%`);
            // Show loading indicator
            const loadingIndicator = document.createElement('div');
            loadingIndicator.className = 'absolute top-0 right-0 bg-blue-500 text-white px-2 py-1 text-sm rounded m-2';
            loadingIndicator.textContent = 'Saving progress...';
            document.querySelector(`#${videoId}`).parentElement.appendChild(loadingIndicator);

            fetch(`${BASE_URL}/api/update-progress`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                credentials: 'include',
                body: JSON.stringify({
                    videoId: videoId,
                    progressPercentage: progressPercentage
                })
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                console.log('Progress updated:', data);
                // Remove loading indicator after successful update
                loadingIndicator.textContent = 'Progress saved!';
                setTimeout(() => loadingIndicator.remove(), 1000);
            })
            .catch(error => {
                console.error('Error updating progress:', error);
                loadingIndicator.textContent = 'Failed to save progress';
                loadingIndicator.className += ' bg-red-500';
                setTimeout(() => loadingIndicator.remove(), 2000);
            });
        }

        // Add session check
        async function checkSession() {
            try {
                const response = await fetch(`${BASE_URL}/api/check_session`, {
                    method: 'GET',
                    credentials: 'include',
                    headers: {
                        'Accept': 'application/json'
                    }
                });
                
                const data = await response.json();
                if (!data.logged_in) {
                    window.location.href = 'login.html';
                } else {
                    sessionStorage.setItem('user_id', data.user.id); // Store user ID in session storage
                }
            } catch (error) {
                console.error('Session check failed:', error);
            }
        }

        // Call checkSession when page loads
        document.addEventListener('DOMContentLoaded', checkSession);

        // Add scroll reveal animation
        document.addEventListener('DOMContentLoaded', () => {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('fade-in');
                    }
                });
            }, { threshold: 0.1 });

            document.querySelectorAll('section').forEach(section => {
                observer.observe(section);
            });
        });

        // Function to update details when user navigates away from courses page
        async function updateDetailsOnNavigation() {
            try {
                const response = await fetch(`${BASE_URL}/api/update_details`, {
                    method: 'POST',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        userId: sessionStorage.getItem('user_id')
                    })
                });

                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const data = await response.json();
                console.log('Details updated:', data);
            } catch (error) {
                console.error('Error updating details:', error);
            }
        }

        // Add event listener for navigation away from courses page
        window.addEventListener('beforeunload', updateDetailsOnNavigation);
    </script>

    <script src="https://www.youtube.com/iframe_api"></script>
</body>
</html>
